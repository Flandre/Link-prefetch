<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <link href="css/main.css" rel="stylesheet">
  <link href="css/animate.min.css" rel="stylesheet">
  <style>
  </style>
</head>
<body>

<img src="" data-src="test/img/001.jpg" id="testImg">
<img src="" data-src="test/img/002.jpg">

<p class="effect" data-an="slideInLeft 1s" id="p1">这是一段文字</p>

<p class="effect" data-an="slideInLeft 2s" data-an-depends="p1" id="p2">这是一段文字</p>

<p class="effect" data-an="slideInLeft 3s" data-an-depends="p2" id="p3">这是一段文字</p>

<p class="effect" data-an="slideInLeft 4s" data-an-depends="p3">这是一段文字</p>

<p class="effect" data-an="slideInLeft 1s" id="p4">这是一段文字</p>

<p class="effect" data-an="slideInLeft 2s" data-an-depends="p4" id="p5">这是一段文字</p>

<p class="effect" data-an="slideInLeft 3s" data-an-depends="p5" id="p6">这是一段文字</p>

<p class="effect" data-an="slideInLeft 4s" data-an-depends="p6">这是一段文字</p>

<button id="btn">执行</button>
<script src="js/jquery.min.js"></script>
<script>
  var startAnimateArr = [];
  $('.effect').each(function () {
    //预处理效果
    $(this).css('visibility', 'hidden');
    if (!$(this).attr('data-an-depends')) {
      startAnimateArr.push($(this))
    }
  });
  console.log(startAnimateArr);
  $('#btn').on('click',function(){
    for (var i = 0; i < startAnimateArr.length; i++) {
      runAnimate(startAnimateArr[i])
    }
  });
  function runAnimate(effectObj) {
    effectObj.css({
      'animation': effectObj.attr('data-an'),
      'visibility': 'visible'
    }).one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
      console.log('shikong is not baka');
      console.error('flandre is baka');
      if (!!$("[data-an-depends="+ effectObj.attr('id') +"]")) {
        runAnimate($("[data-an-depends="+ effectObj.attr('id') +"]"))
      }else{
        return false;
      }
    })
  }
</script>
</body>
</html>
